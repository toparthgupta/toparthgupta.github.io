<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light">
  <title>Culina Desserts — Sweet Indulgences</title>
  <meta name="description" content="Indulge in decadent desserts from classic chocolate cakes to delicate pastries, creamy puddings, and artisanal confections.">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --surface: #fdfcfb;
      --elevated: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --brand: #c2410c; /* Warm dessert orange */
      --brand-600: #9a3412;
      --accent: #7c2d12; /* Rich chocolate brown */
      --brand-2: #f59e0b; /* Golden amber */
      --success: #10b981;
      --danger: #ef4444;
      --ring: rgba(194, 65, 12, .30);
      --shadow-sm: 0 1px 2px rgba(16,24,40,.06);
      --shadow-md: 0 10px 30px rgba(16,24,40,.08);
      --shadow-lg: 0 30px 70px rgba(16,24,40,.10);
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 22px;
      --space: clamp(14px, 1.2vw, 18px);
      --max: 1200px;
      --hero-img: url('https://images.unsplash.com/photo-1551024506-0bccd828d307?q=80&w=1600&auto=format&fit=crop');
    }

    /* Reset */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1100px 480px at 85% -220px, rgba(194,65,12,.08), transparent 60%),
                  radial-gradient(900px 380px at 10% -120px, rgba(245,158,11,.10), transparent 60%),
                  var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    img { max-width: 100%; display: block; }
    a { color: inherit; text-decoration: none; }
    button { font: inherit; color: inherit; }
    .container { max-width: var(--max); margin: 0 auto; padding: 0 calc(var(--space) * 1.1); }

    /* Skip link */
    .skip-link { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { left: 12px; top: 12px; width: auto; height: auto; background: var(--elevated); padding: 10px 14px; border-radius: 8px; box-shadow: var(--shadow-md); z-index: 1000; }

    /* Header */
    .site-header { position: sticky; top: 0; z-index: 50; backdrop-filter: saturate(160%) blur(10px); background: color-mix(in oklab, var(--bg) 94%, transparent); border-bottom: 1px solid rgba(100,116,139,.10); }
    .topbar { display: grid; grid-template-columns: 200px 1fr auto; align-items: center; gap: 14px; padding: 12px 0; }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; letter-spacing: .5px; }
    .brand .logo { width: 34px; height: 34px; display: grid; place-items: center; border-radius: 10px; background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: inset 0 0 0 2px rgba(255,255,255,.6); }
    .brand span { font-family: "Playfair Display", Georgia, serif; font-size: 22px; }

    .search { position: relative; }
    .search input { width: 100%; border: 1px solid rgba(100,116,139,.18); background: var(--elevated); color: var(--text); border-radius: 12px; padding: 12px 40px; outline: none; box-shadow: var(--shadow-sm); }
    .search input:focus { border-color: var(--brand); box-shadow: 0 0 0 6px var(--ring); }
    .search .icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); }
    .actions { display: flex; align-items: center; gap: 10px; }
    .btn { border: 1px solid rgba(100,116,139,.18); background: var(--elevated); padding: 10px 12px; border-radius: 12px; display: inline-flex; align-items: center; gap: 8px; cursor: pointer; transition: transform .08s ease, box-shadow .2s ease; }
    .btn:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }
    .btn.primary { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: white; border: none; box-shadow: 0 8px 20px rgba(194,65,12,.25); }

    /* Nav */
    .main-nav { border-top: 1px solid rgba(100,116,139,.10); }
    .main-nav .nav-inner { display: flex; gap: 18px; overflow:auto; padding: 10px 0; scrollbar-width: none; }
    .chip { white-space: nowrap; border: 1px solid rgba(100,116,139,.16); padding: 8px 12px; border-radius: 999px; color: var(--muted); background: var(--elevated); cursor: pointer; transition: transform .12s ease, box-shadow .2s ease, background .2s ease; }
    .chip:hover { box-shadow: 0 6px 16px rgba(194,65,12,.12); transform: translateY(-1px); }
    .chip[aria-current="page"], .chip.active { background: linear-gradient(135deg, rgba(194,65,12,.12), rgba(245,158,11,.12)); color: var(--brand-600); border-color: rgba(194,65,12,.25); font-weight: 600; }

    /* Hero */
    .hero { position: relative; isolation: isolate; }
    .hero-inner { display: grid; grid-template-columns: 1.2fr .8fr; gap: 28px; align-items: center; padding: clamp(28px, 5vw, 64px) 0; }
    .headline { font-family: "Playfair Display", Georgia, serif; font-weight: 700; letter-spacing: .3px; font-size: clamp(34px, 6vw, 60px); line-height: 1.04; margin: 0 0 12px; }
    .subhead { color: var(--muted); font-size: clamp(16px, 1.8vw, 18px); max-width: 58ch; }
    .hero-cta { display: flex; gap: 12px; margin-top: 18px; }
    .hero-illustration { position: relative; border-radius: var(--radius-lg); height: clamp(260px, 36vw, 460px); box-shadow: var(--shadow-lg); overflow: hidden; background:
      linear-gradient( to bottom right, rgba(194,65,12,.25), rgba(245,158,11,.25) ),
      var(--hero-img) center/cover no-repeat; }
    .hero-illustration::after { content: ""; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(255,255,255,.0), rgba(255,255,255,.08) 60%, rgba(255,255,255,.25)); }
    .statbar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 16px; }
    .stat { background: var(--elevated); border: 1px solid rgba(100,116,139,.12); padding: 14px; border-radius: 14px; text-align: center; box-shadow: var(--shadow-sm); }
    .stat b { display: block; font-size: 18px; }
    .stat span { color: var(--muted); font-size: 12px; }

    /* Filters */
    .filters { margin-top: 10px; display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center; }
    .filters .chips { display: flex; gap: 10px; flex-wrap: wrap; }
    .select { border: 1px solid rgba(100,116,139,.18); padding: 10px 12px; border-radius: 10px; background: var(--elevated); color: var(--muted); }

    /* Recipe Grid */
    .section { padding: clamp(24px, 4vw, 48px) 0; }
    .section h2 { font-family: "Playfair Display", Georgia, serif; font-size: clamp(26px, 4.2vw, 40px); margin: 0 0 18px; letter-spacing: .2px; background: linear-gradient(90deg, rgba(194,65,12,.12), rgba(245,158,11,.12)); -webkit-background-clip: text; background-clip: text; color: var(--text); }
    .recipes-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 18px; }
    @media (max-width: 1000px) { .recipes-grid { grid-template-columns: repeat(2, 1fr); } .hero-inner { grid-template-columns: 1fr; } }
    @media (max-width: 640px) { .recipes-grid { grid-template-columns: 1fr; } .filters { grid-template-columns: 1fr; } .topbar { grid-template-columns: 1fr; grid-auto-rows: auto; } }

    .card { position: relative; background: var(--elevated); border: 1px solid rgba(100,116,139,.12); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-sm); transition: transform .25s ease, box-shadow .25s ease; cursor: pointer; }
    .card:hover { transform: translateY(-6px); box-shadow: var(--shadow-lg); }
    .card img { aspect-ratio: 16/11; object-fit: cover; width: 100%; }
    .card-body { padding: 12px 14px 14px; }
    .meta { display: flex; align-items: center; gap: 10px; color: var(--muted); font-size: 13px; }
    .title { font-weight: 700; margin: 6px 0 8px; line-height: 1.3; }
    .tag { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: rgba(194,65,12,.12); color: var(--brand-600); border: 1px solid rgba(194,65,12,.25); }
    .label { position: absolute; top: 10px; left: 10px; z-index: 2; padding: 6px 10px; border-radius: 999px; background: linear-gradient(135deg, rgba(194,65,12,.95), rgba(245,158,11,.95)); color: #fff; font-size: 12px; box-shadow: 0 6px 16px rgba(16,24,40,.16); }
    .fav { position: absolute; right: 10px; top: 10px; width: 36px; height: 36px; display: grid; place-items: center; border-radius: 999px; background: rgba(0,0,0,.45); color: white; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,.2); }
    .fav.active { background: rgba(239,68,68,.92); }

    /* Modal extras */
    .info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 10px 0 6px; }
    .info-item { border: 1px solid rgba(100,116,139,.14); background: var(--elevated); border-radius: 10px; padding: 8px 10px; text-align: center; box-shadow: var(--shadow-sm); }
    .info-item b { display: block; font-size: 14px; }
    .info-item span { display: block; color: var(--muted); font-size: 12px; }
    .gallery { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .gallery img { width: 78px; height: 78px; object-fit: cover; border-radius: 10px; border: 1px solid rgba(100,116,139,.18); cursor: pointer; opacity: .9; transition: transform .1s ease, opacity .15s ease; }
    .gallery img:hover { transform: translateY(-1px); opacity: 1; box-shadow: var(--shadow-sm); }
    .gallery img.active { outline: 2px solid var(--brand); opacity: 1; }
    .nutrition { margin: 0; padding-left: 18px; line-height: 1.7; }

    /* Modal */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal.active { display: flex; }
    .modal::before { content: ""; position: absolute; inset: 0; background: rgba(3,7,18,.7); backdrop-filter: blur(6px); }
    .dialog { position: relative; width: min(900px, 92vw); max-height: 86vh; overflow: auto; background: var(--elevated); border: 1px solid rgba(100,116,139,.2); border-radius: 16px; box-shadow: var(--shadow-lg); }
    .dialog header { position: sticky; top: 0; background: inherit; border-bottom: 1px solid rgba(100,116,139,.14); padding: 14px 18px; display: flex; align-items: center; justify-content: space-between; }
    .dialog .body { padding: 16px 18px 22px; display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
    @media (max-width: 800px) { .dialog .body { grid-template-columns: 1fr; } }
    .dialog h3 { margin: 0; font-size: 22px; }
    .dialog .subtitle { color: var(--muted); margin: 4px 0 0; font-size: 14px; }
    .dialog ul { margin: 0; padding-left: 18px; line-height: 1.7; }
    .close { border: 1px solid rgba(100,116,139,.18); background: var(--elevated); border-radius: 10px; width: 36px; height: 36px; display: grid; place-items: center; }

    /* Footer */
    footer { border-top: 1px solid rgba(100,116,139,.12); background: var(--surface); margin-top: 28px; }
    .footer-inner { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 16px; padding: 28px 0; }
    @media (max-width: 900px) { .footer-inner { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px) { .footer-inner { grid-template-columns: 1fr; } }
    .footer-col h4 { margin: 0 0 10px; font-size: 16px; }
    .footer-col a { color: var(--muted); display: block; padding: 6px 0; }
    .newsletter { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
    .newsletter input { border: 1px solid rgba(100,116,139,.18); padding: 10px 12px; border-radius: 10px; background: var(--elevated); }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <header class="site-header" role="banner">
    <div class="container topbar">
      <a class="brand" href="../index.html" aria-label="Culina home">
        <span class="logo" aria-hidden="true"></span>
        <span>Culina Desserts</span>
      </a>
      <label class="search" for="searchInput">
        <svg class="icon" width="18" height="18" fill="none" viewBox="0 0 24 24" aria-hidden="true"><path stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"/></svg>
        <input id="searchInput" type="search" placeholder="Search dessert recipes…" autocomplete="off" aria-label="Search recipes" data-track="input" data-track-type="search">
      </label>
      <div class="actions">
        <button class="btn" id="favoritesBtn" aria-label="View favorites" data-track="click" data-track-type="action" data-track-id="viewFavorites"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 21s-7.5-4.7-9.4-8.3C1 9.6 2.6 6.8 5.4 6.2c1.9-.4 3.8.3 4.9 1.8 1.1-1.6 3-2.3 4.9-1.8 2.7.6 4.4 3.4 2.8 6.5C19.5 16.3 12 21 12 21z"/></svg><span id="favCount" aria-live="polite">0</span></button>
        <button class="btn primary" id="subscribeBtn" data-track="click" data-track-type="action" data-track-id="subscribeClick">Subscribe</button>
      </div>
    </div>
    <nav class="main-nav" aria-label="Primary">
      <div class="container nav-inner">
        <a class="chip" href="index.html" data-track="click" data-track-type="navigation">Recipe Home</a>
        <a class="chip" href="asian.html" data-track="click" data-track-type="navigation">Asian Cuisine</a>
        <a class="chip" href="#cakes" data-track="click" data-track-type="section">Cakes</a>
        <a class="chip" href="#pastries" data-track="click" data-track-type="section">Pastries</a>
        <a class="chip" href="#cookies" data-track="click" data-track-type="section">Cookies</a>
        <a class="chip" href="#puddings" data-track="click" data-track-type="section">Puddings</a>
        <a class="chip" href="#pies" data-track="click" data-track-type="section">Pies</a>
        <a class="chip" href="#frozen" data-track="click" data-track-type="section">Frozen</a>
      </div>
    </nav>
  </header>

  <main id="main" tabindex="-1">
    <section class="container hero" aria-labelledby="heroTitle">
      <div class="hero-inner">
        <div>
          <h1 id="heroTitle" class="headline">Sweet Indulgences</h1>
          <p class="subhead">From decadent chocolate cakes to delicate pastries and creamy puddings—discover desserts that celebrate life's sweetest moments.</p>
          <div class="hero-cta">
            <a href="#recipes" class="btn primary" data-track="click" data-track-type="section">Explore Desserts</a>
            <button class="btn" id="randomBtn" data-track="click" data-track-type="action" data-track-id="randomHungry">Sweet Surprise!</button>
          </div>
          <div class="statbar">
            <div class="stat"><b id="statRecipes">0</b><span>Desserts</span></div>
            <div class="stat"><b>15</b><span>Categories</span></div>
            <div class="stat"><b>120k+</b><span>Sweet Tooths</span></div>
          </div>
        </div>
        <div class="hero-illustration" aria-hidden="true"></div>
      </div>
    </section>

    <section id="recipes" class="container section" aria-labelledby="recipesTitle">
      <h2 id="recipesTitle">Sweet Treats</h2>
      <div class="filters" role="region" aria-label="Recipe filters">
        <div class="chips" id="categoryChips"></div>
        <select id="dietSelect" class="select" aria-label="Diet" data-track="change" data-track-type="diet">
          <option value="">All Types</option>
          <option>Vegetarian</option>
          <option>Vegan</option>
          <option>Gluten‑Free</option>
          <option>Dairy‑Free</option>
        </select>
        <select id="sortSelect" class="select" aria-label="Sort" data-track="change" data-track-type="action" data-track-id="sort">
          <option value="pop">Most Popular</option>
          <option value="new">Newest</option>
          <option value="time">Quickest</option>
        </select>
      </div>

      <div class="recipes-grid" id="grid" aria-live="polite"></div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container footer-inner">
      <div class="footer-col">
        <h4>Sweet News!</h4>
        <div class="newsletter">
          <input id="email" type="email" placeholder="Enter your email" aria-label="Email address" data-track="input" data-track-type="action" data-track-id="emailInput">
          <button class="btn primary" id="joinBtn" data-track="click" data-track-type="action" data-track-id="newsletterJoin">Join</button>
        </div>
        <p class="subhead" style="margin-top:8px;font-size:13px">Get the latest dessert recipes and tips.</p>
      </div>
      <div class="footer-col">
        <h4>Categories</h4>
        <a href="#">Cakes</a>
        <a href="#">Pastries</a>
        <a href="#">Cookies</a>
        <a href="#">Puddings</a>
      </div>
      <div class="footer-col">
        <h4>Techniques</h4>
        <a href="#">Baking</a>
        <a href="#">Decorating</a>
        <a href="#">Tempering</a>
        <a href="#">Pastry</a>
      </div>
      <div class="footer-col">
        <h4>Ingredients</h4>
        <a href="#">Chocolate</a>
        <a href="#">Vanilla</a>
        <a href="#">Butter</a>
        <a href="#">Sugar Types</a>
      </div>
    </div>
  </footer>

  <!-- Recipe Modal -->
  <div class="modal" id="recipeModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="dialog">
      <header>
        <div>
          <h3 id="modalTitle">Recipe</h3>
          <div class="subtitle" id="modalSubtitle"></div>
        </div>
        <button class="close" id="closeModal" aria-label="Close">✕</button>
      </header>
      <div class="body">
        <div>
          <img id="modalImg" alt="">
          <div class="info-grid" id="modalInfo"></div>
          <p id="modalDesc" class="subhead" style="margin-top:6px"></p>
          <div class="gallery" id="modalGallery"></div>
        </div>
        <div>
          <h4>Ingredients</h4>
          <ul id="modalIngredients"></ul>
          <h4>Instructions</h4>
          <ol id="modalSteps"></ol>
          <h4>Nutrition</h4>
          <ul id="modalNutrition" class="nutrition"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Generic interest tracking framework -->
  <script src="./interest-kit.js"></script>

  <script>
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const state = {
      favorites: new Set(JSON.parse(localStorage.getItem('culina:desserts:favs') || '[]')),
      query: '',
      category: 'All',
      diet: '',
      sort: 'pop'
    };

    function debounce(fn, delay){ let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn(...args), delay); }; }

    const CATEGORIES = ['All','Cakes','Pastries','Cookies','Puddings','Pies','Frozen'];
    const RECIPES = [
      { id: 'chocolate-cake', name: 'Decadent Chocolate Cake', category: 'Cakes', diet: 'Vegetarian', time: 90, rating: 4.9, pop: 98,
        img: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?q=80&w=1200&auto=format&fit=crop',
        gallery: [
          'https://images.unsplash.com/photo-1578985545062-69928b1d9587?q=80&w=1200&auto=format&fit=crop',
          'https://images.unsplash.com/photo-1606890737304-57a1ca8a5b62?q=80&w=1200&auto=format&fit=crop'
        ],
        description: 'Rich, moist chocolate cake with silky ganache frosting and a deep cocoa flavor.',
        servings: 12,
        difficulty: 'Medium',
        nutrition: { calories: 450, protein: '6g', fat: '22g', carbs: '58g' },
        tags: ['Chocolate','Rich','Birthday'],
        ingredients: ['Dark chocolate','Butter','Sugar','Eggs','Flour','Cocoa powder','Heavy cream','Vanilla extract','Coffee'],
        steps: [
          'Melt chocolate and butter together until smooth.',
          'Whisk eggs and sugar until pale and fluffy.',
          'Combine dry ingredients in separate bowl.',
          'Fold chocolate mixture into eggs, then add dry ingredients.',
          'Bake in prepared pans at 350°F for 25-30 minutes.',
          'Make ganache and frost cooled cake layers.'
        ] },
      { id: 'croissant', name: 'Butter Croissants', category: 'Pastries', diet: 'Vegetarian', time: 480, rating: 4.7, pop: 89,
        img: 'https://www.hormelfoods.com/wp-content/uploads/culinary_collective_croissants-Recipe-2400x1000-1.1692042266.jpg',
        gallery: [
          'https://via.placeholder.com/1200x800/FFE4B5/8B4513?text=Golden+Butter+Croissants',
          'https://via.placeholder.com/1200x800/F5DEB3/8B4513?text=Flaky+Croissant+Layers',
          'https://via.placeholder.com/1200x800/DEB887/8B4513?text=Fresh+Baked+Croissants',
          'https://via.placeholder.com/1200x800/F4A460/8B4513?text=Croissant+Cross+Section'
        ],
        description: 'Flaky, buttery French pastries with perfect lamination and golden exterior.',
        servings: 8,
        difficulty: 'Hard',
        nutrition: { calories: 320, protein: '7g', fat: '18g', carbs: '34g' },
        tags: ['French','Buttery','Laminated'],
        ingredients: ['Bread flour','Butter','Milk','Sugar','Salt','Yeast','Egg wash'],
        steps: [
          'Make dough and let rise for 1 hour.',
          'Prepare butter block and chill.',
          'Laminate dough with butter through 3 letter folds.',
          'Chill between each fold for 30 minutes.',
          'Roll and shape into croissants.',
          'Proof for 2 hours, brush with egg wash, and bake at 375°F.'
        ] },
      { id: 'chocolate-chip-cookies', name: 'Classic Chocolate Chip Cookies', category: 'Cookies', diet: 'Vegetarian', time: 25, rating: 4.8, pop: 96,
        img: 'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?q=80&w=1200&auto=format&fit=crop',
        gallery: [
          'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?q=80&w=1200&auto=format&fit=crop'
        ],
        description: 'Perfectly chewy cookies with crispy edges and melty chocolate chips.',
        servings: 24,
        difficulty: 'Easy',
        nutrition: { calories: 180, protein: '2g', fat: '9g', carbs: '24g' },
        tags: ['Classic','Chewy','Family'],
        ingredients: ['Butter','Brown sugar','White sugar','Eggs','Vanilla','Flour','Baking soda','Salt','Chocolate chips'],
        steps: [
          'Cream butter and sugars until fluffy.',
          'Beat in eggs and vanilla.',
          'Mix in flour, baking soda, and salt.',
          'Fold in chocolate chips.',
          'Drop onto baking sheets and bake at 375°F for 9-11 minutes.',
          'Cool on sheets for 5 minutes before transferring.'
        ] },
      { id: 'creme-brulee', name: 'Crème Brûlée', category: 'Puddings', diet: 'Vegetarian', time: 240, rating: 4.6, pop: 85,
        img: 'https://images.unsplash.com/photo-1470124182917-cc6e71b22ecc?q=80&w=1200&auto=format&fit=crop',
        gallery: [
          'https://images.unsplash.com/photo-1470124182917-cc6e71b22ecc?q=80&w=1200&auto=format&fit=crop'
        ],
        description: 'Silky vanilla custard topped with caramelized sugar crust.',
        servings: 6,
        difficulty: 'Medium',
        nutrition: { calories: 280, protein: '5g', fat: '22g', carbs: '18g' },
        tags: ['French','Custard','Elegant'],
        ingredients: ['Heavy cream','Egg yolks','Sugar','Vanilla bean','Salt'],
        steps: [
          'Heat cream with vanilla bean until steaming.',
          'Whisk egg yolks with sugar until pale.',
          'Temper cream into yolks gradually.',
          'Strain mixture and divide among ramekins.',
          'Bake in water bath at 325°F for 30-35 minutes.',
          'Chill for 2 hours, then torch sugar topping before serving.'
        ] },
      { id: 'apple-pie', name: 'Classic Apple Pie', category: 'Pies', diet: 'Vegetarian', time: 120, rating: 4.7, pop: 92,
        img: 'https://img.taste.com.au/K3ExWmsZ/w720-h480-cfill-q80/taste/2016/11/classic-apple-pie-84181-1.jpeg',
        gallery: [
          'https://via.placeholder.com/1200x800/D2691E/FFFAF0?text=Classic+Apple+Pie',
          'https://via.placeholder.com/1200x800/CD853F/FFFAF0?text=Apple+Pie+Slice',
          'https://via.placeholder.com/1200x800/DEB887/8B4513?text=Lattice+Crust+Pattern',
          'https://via.placeholder.com/1200x800/F4A460/8B4513?text=Fresh+Apple+Filling'
        ],
        description: 'Traditional American pie with spiced apples in flaky pastry crust.',
        servings: 8,
        difficulty: 'Medium',
        nutrition: { calories: 420, protein: '4g', fat: '18g', carbs: '65g' },
        tags: ['American','Spiced','Comfort'],
        ingredients: ['Pie crust','Apples','Sugar','Cinnamon','Nutmeg','Flour','Butter','Lemon juice'],
        steps: [
          'Roll out bottom crust and place in pie pan.',
          'Toss sliced apples with sugar, spices, and flour.',
          'Fill crust with apple mixture and dot with butter.',
          'Cover with top crust and seal edges.',
          'Cut vents and brush with egg wash.',
          'Bake at 425°F for 45-50 minutes until golden.'
        ] },
      { id: 'vanilla-ice-cream', name: 'Vanilla Bean Ice Cream', category: 'Frozen', diet: 'Vegetarian', time: 300, rating: 4.5, pop: 88,
        img: 'https://images.unsplash.com/photo-1570197788417-0e82375c9371?q=80&w=1200&auto=format&fit=crop',
        gallery: [
          'https://images.unsplash.com/photo-1570197788417-0e82375c9371?q=80&w=1200&auto=format&fit=crop'
        ],
        description: 'Creamy homemade ice cream with real vanilla beans and rich custard base.',
        servings: 8,
        difficulty: 'Medium',
        nutrition: { calories: 220, protein: '4g', fat: '14g', carbs: '22g' },
        tags: ['Creamy','Vanilla','Homemade'],
        ingredients: ['Heavy cream','Milk','Sugar','Egg yolks','Vanilla beans','Salt'],
        steps: [
          'Heat cream and milk with vanilla beans.',
          'Whisk egg yolks with sugar until pale.',
          'Temper hot cream into yolks slowly.',
          'Cook custard until it coats a spoon (170°F).',
          'Strain and chill completely.',
          'Churn in ice cream maker according to manufacturer instructions.'
        ] }
    ];

    function saveFavs() {
      localStorage.setItem('culina:desserts:favs', JSON.stringify([...state.favorites]));
      $('#favCount').textContent = state.favorites.size;
    }

    function starRating(r) {
      const full = Math.floor(r), half = r - full >= 0.5;
      return '<span aria-label="Rating ' + r + ' out of 5">' +
        '★★★★★'.slice(0, full) + (half ? '½' : '') + '</span>';
    }

    function renderCategoryChips() {
      const box = $('#categoryChips');
      box.innerHTML = '';
      CATEGORIES.forEach(cat => {
        const a = document.createElement('button');
        a.className = 'chip' + (state.category === cat ? ' active' : '');
        a.type = 'button'; a.textContent = cat; a.setAttribute('aria-pressed', state.category === cat);
        a.dataset.track = 'click'; a.dataset.trackType = 'category'; a.dataset.trackId = cat;
        a.addEventListener('click', () => { state.category = cat; renderGrid(); });
        box.appendChild(a);
      });
    }

    function filterSort(list) {
      const q = state.query.toLowerCase();
      let out = list.filter(r =>
        (!q || r.name.toLowerCase().includes(q) || r.tags.some(t => t.toLowerCase().includes(q))) &&
        (state.category === 'All' || r.category === state.category) &&
        (!state.diet || r.diet === state.diet)
      );
      if (state.sort === 'new') out = out.slice().reverse();
      if (state.sort === 'time') out = out.slice().sort((a,b)=>a.time-b.time);
      if (state.sort === 'pop') out = out.slice().sort((a,b)=>b.pop-a.pop);
      return out;
    }

    function recipeCard(r) {
      const fav = state.favorites.has(r.id);
      return `
        <article class="card" data-id="${r.id}" role="button" aria-label="Open ${r.name}" title="${r.name}"
                 data-track="click view" data-track-type="recipe" data-track-id="${r.id}"
                 data-track-category="${r.category}" data-track-tags="${r.tags.join(',')}"
                 data-track-title="${r.name}" data-track-time="${r.time}" data-track-rating="${r.rating}" data-track-diet="${r.diet}">
          <span class="label">${r.tags[0] || 'Featured'}</span>
          <img src="${r.img}" alt="${r.name}" loading="lazy" decoding="async">
          <button class="fav ${fav ? 'active' : ''}" aria-label="Favorite ${r.name}" data-fav="${r.id}"
                  data-track="click" data-track-type="action" data-track-id="favorite" data-track-label="${r.id}"
                  data-track-category="${r.category}" data-track-tags="${r.tags.join(',')}"
                  data-track-title="${r.name}">❤</button>
          <div class="card-body">
            <div class="tag">${r.category}</div>
            <div class="title">${r.name}</div>
            <div class="meta">
              <span>⏱ ${r.time} min</span>
              <span>•</span>
              <span>${starRating(r.rating)}</span>
            </div>
          </div>
        </article>`;
    }

    function renderGrid() {
      const list = filterSort(RECIPES);
      $('#grid').innerHTML = list.map(recipeCard).join('');
      $('#statRecipes').textContent = RECIPES.length;

      // Wire favorites and modal
      $$('#grid .fav').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const id = btn.dataset.fav;
          if (state.favorites.has(id)) state.favorites.delete(id); else state.favorites.add(id);
          btn.classList.toggle('active');
          saveFavs();
        });
      });
      $$('#grid .card').forEach(card => card.addEventListener('click', () => openRecipe(card.dataset.id)));
    }

    function openRecipe(id) {
      const r = RECIPES.find(x=>x.id===id); if (!r) return;
      $('#modalTitle').textContent = r.name;
      $('#modalSubtitle').textContent = r.tags.join(' • ');
      $('#modalImg').src = r.img; $('#modalImg').alt = r.name;
      // Info grid
      $('#modalInfo').innerHTML = `
        <div class="info-item"><b>${r.time} min</b><span>Time</span></div>
        <div class="info-item"><b>${r.servings || 2}</b><span>Servings</span></div>
        <div class="info-item"><b>${r.difficulty || 'Easy'}</b><span>Difficulty</span></div>
        <div class="info-item"><b>${r.rating}</b><span>Rating</span></div>
      `;
      // Description
      $('#modalDesc').textContent = r.description || '';
      $('#modalIngredients').innerHTML = r.ingredients.map(i=>`<li>${i}</li>`).join('');
      $('#modalSteps').innerHTML = r.steps.map(s=>`<li>${s}</li>`).join('');
      // Nutrition
      const n = r.nutrition || {};
      $('#modalNutrition').innerHTML = Object.keys(n).length ? [
        n.calories != null ? `<li>Calories: ${n.calories}</li>` : '',
        n.protein ? `<li>Protein: ${n.protein}</li>` : '',
        n.fat ? `<li>Fat: ${n.fat}</li>` : '',
        n.carbs ? `<li>Carbs: ${n.carbs}</li>` : ''
      ].filter(Boolean).join('') : '<li>No nutrition data.</li>';
      // Gallery
      const g = (r.gallery && r.gallery.length ? r.gallery : [r.img]);
      $('#modalGallery').innerHTML = g.map((src, i)=>`<img src="${src}" alt="${r.name} photo ${i+1}" ${i===0?'class="active"':''} loading="lazy" data-track="click view" data-track-type="action" data-track-id="galleryThumb" data-track-title="${r.name}">`).join('');
      $$('#modalGallery img').forEach((imgEl, idx) => {
        imgEl.addEventListener('click', () => {
          $('#modalImg').src = imgEl.src;
          $$('#modalGallery img').forEach(m=>m.classList.remove('active'));
          imgEl.classList.add('active');
        });
      });
      const m = $('#recipeModal'); m.classList.add('active'); m.removeAttribute('aria-hidden');
      $('#closeModal').focus();
    }

    function closeModal() {
      const m = $('#recipeModal'); m.classList.remove('active'); m.setAttribute('aria-hidden','true');
    }

    function wireHeader() {
      $('#searchInput').addEventListener('input', (e)=>{ state.query = e.target.value; renderGrid(); });
      $('#dietSelect').addEventListener('input', (e)=>{ state.diet = e.target.value; renderGrid(); });
      $('#sortSelect').addEventListener('input', (e)=>{ state.sort = e.target.value; renderGrid(); });
      $('#randomBtn').addEventListener('click', ()=>{ const r = RECIPES[Math.floor(Math.random()*RECIPES.length)]; openRecipe(r.id); });
      $('#favoritesBtn').addEventListener('click', ()=>{
        if (state.favorites.size === 0) return alert('No favorites yet. Tap the heart on any recipe.');
        const list = RECIPES.filter(r=>state.favorites.has(r.id));
        $('#grid').innerHTML = list.map(recipeCard).join('');
      });
      $('#subscribeBtn').addEventListener('click', ()=> { alert('Thank you! Sweet recipes coming your way.'); });
      $('#joinBtn').addEventListener('click', ()=> {
        const email = $('#email').value.trim();
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return alert('Enter a valid email.');
        alert('Welcome to Culina Desserts!'); $('#email').value = '';
      });
    }

    // Modal close and accessibility
    $('#closeModal').addEventListener('click', closeModal);
    $('#recipeModal').addEventListener('click', (e)=>{ if (e.target.id === 'recipeModal') closeModal(); });
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeModal(); });

    // Init
    (function init(){
      renderCategoryChips();
      renderGrid();
      wireHeader();
      saveFavs();
    })();
  </script>
</body>
</html>
