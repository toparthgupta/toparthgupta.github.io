<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <title>Fast Salesforce SOQL Tool - No Server Required</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #0066cc;
        }
        
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover { background: #0052a3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        .secondary { background: #6c757d; }
        .secondary:hover { background: #5a6268; }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .results {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            min-height: 300px;
            padding: 20px;
            overflow: auto;
            max-height: 600px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }
        
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover { background: #f8f9fa; }
        
        .loading {
            text-align: center;
            color: #0066cc;
            font-size: 16px;
            padding: 40px;
        }
        
        .quick-queries {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .quick-queries button {
            font-size: 12px;
            padding: 8px 16px;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Fast Salesforce SOQL Tool</h1>
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
            <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è CORS Notice</h4>
            <p style="color: #856404;">Direct Salesforce API calls will be blocked by CORS from external domains.</p>
            <p style="color: #856404; margin-top: 5px;"><strong>This works when served from your Salesforce instance or localhost.</strong></p>
        </div>
        

        
        <!-- Connection Setup -->
        <div class="card">
            <h3>Connection Setup</h3>
            <div class="input-group">
                <label>Salesforce Instance URL:</label>
                <input type="url" id="instanceUrl" value="https://gus.my.salesforce.com" placeholder="https://your-instance.salesforce.com">
            </div>
            <div class="input-group">
                <label>Session ID:</label>
                <input type="text" id="sessionId" placeholder="00DT0000000Dpvc!AQEAQAAZwi..." style="font-size: 11px;">
            </div>
            <button onclick="testConnection()">Test Connection</button>
            <div id="connectionStatus"></div>
        </div>

        <!-- SOQL Query -->
        <div class="card">
            <h3>SOQL Query</h3>
            <div class="quick-queries">
                <button class="secondary" onclick="setQuery('SELECT Id, Name FROM Account LIMIT 10')">Accounts</button>
                <button class="secondary" onclick="setQuery('SELECT Id, Name, Email FROM User WHERE IsActive = true LIMIT 10')">Users</button>
                <button class="secondary" onclick="setQuery('SELECT Id, Name FROM Topic LIMIT 10')">Topics</button>
                <button class="secondary" onclick="setQuery('SELECT Id FROM Organization')">Org Info</button>
                <button class="secondary" onclick="setQuery('SELECT Id, Subject, Status FROM Case LIMIT 10')">Cases</button>
            </div>
            <div class="input-group">
                <textarea id="soqlQuery" rows="4" placeholder="SELECT Id, Name FROM Account LIMIT 10">SELECT Id, Name FROM Account LIMIT 10</textarea>
            </div>
            <button onclick="executeQuery()">Execute Query</button>
            <button class="secondary" onclick="formatQuery()">Format</button>
            <button class="secondary" onclick="clearResults()">Clear</button>
        </div>

        <!-- Results -->
        <div class="card">
            <h3>Results</h3>
            <div id="queryStatus"></div>
            <div id="results" class="results">
                <div style="text-align: center; color: #666; padding: 40px;">
                    Enter your session ID and execute a query
                </div>
            </div>
        </div>

        <a href="soql.html">Query</a>
    </div>

    <script>
        // Global state
        let lastQuery = null;
        let lastResults = null;

        // YOUR EXACT FETCH CALL
        async function callSalesforce(url, sessionId) {
            const start = Date.now();
            
            try {
                const response = await fetch(url, {
                    "headers": {
                        "accept": "application/json, text/plain, */*",
                        "accept-language": "en-GB,en-US;q=0.9,en;q=0.8",
                        "authorization": `Bearer ${sessionId}`,
                        "X-SFDC-Session": sessionId,
                        "cache-control": "no-store",
                        "dnt": "1",
                        "priority": "u=1, i",
                        "sec-ch-ua": "\"Not;A=Brand\";v=\"99\", \"Google Chrome\";v=\"139\", \"Chromium\";v=\"139\"",
                        "sec-ch-ua-mobile": "?0",
                        "sec-ch-ua-platform": "\"macOS\"",
                        "sec-fetch-dest": "empty",
                        "sec-fetch-mode": "cors",
                        "sec-fetch-site": "none",
                        "sec-fetch-storage-access": "active",
                        "sforce-call-options": "client=WBApp",
                        "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36"
                    },
                    "body": null,
                    "method": "GET",
                    "mode": "cors",
                    "credentials": "include"
                });

                const data = await response.json();
                const time = Date.now() - start;
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data,
                    time: time
                };

            } catch (error) {
                const time = Date.now() - start;
                let errorMsg = error.message;
                
                if (errorMsg.includes('CORS') || errorMsg.includes('blocked')) {
                    errorMsg = 'CORS blocked by Salesforce. Copy this file to your Salesforce instance or disable CORS in browser.';
                }
                
                return {
                    success: false,
                    error: errorMsg,
                    time: time
                };
            }
        }

        async function testConnection() {
            const instanceUrl = document.getElementById('instanceUrl').value.trim();
            const sessionId = document.getElementById('sessionId').value.trim();
            
            if (!instanceUrl || !sessionId) {
                showStatus('Please enter instance URL and session ID', 'error');
                return;
            }

            showStatus('Testing connection...', 'info');
            
            const url = `${instanceUrl}/services/data/v65.0/query?q=${encodeURIComponent('SELECT Id FROM Organization LIMIT 1')}`;
            const result = await callSalesforce(url, sessionId);
            
            if (result.success) {
                showStatus(`‚úÖ Connected successfully in ${result.time}ms`, 'success');
            } else {
                showStatus(`‚ùå Connection failed: ${result.error || result.data?.[0]?.message}`, 'error');
            }
        }

        async function executeQuery() {
            const instanceUrl = document.getElementById('instanceUrl').value.trim();
            const sessionId = document.getElementById('sessionId').value.trim();
            const soql = document.getElementById('soqlQuery').value.trim();
            
            if (!instanceUrl || !sessionId || !soql) {
                showStatus('Please fill in all fields', 'error');
                return;
            }

            showStatus('Executing query...', 'info');
            document.getElementById('results').innerHTML = '<div class="loading">‚ö° Executing query...</div>';
            
            const url = `${instanceUrl}/services/data/v65.0/query?q=${encodeURIComponent(soql)}`;
            const result = await callSalesforce(url, sessionId);
            
            if (result.success && result.data.totalSize !== undefined) {
                lastResults = result.data;
                displayResults(result.data);
                showStatus(`‚úÖ Query executed in ${result.time}ms - ${result.data.totalSize} records`, 'success');
            } else {
                const errorMsg = result.data?.[0]?.message || result.error || 'Query failed';
                document.getElementById('results').innerHTML = `<div style="color: red; padding: 20px;">‚ùå ${errorMsg}</div>`;
                showStatus(`‚ùå Query failed in ${result.time}ms: ${errorMsg}`, 'error');
            }
        }

        function displayResults(data) {
            if (!data.records || data.records.length === 0) {
                document.getElementById('results').innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No records found</div>';
                return;
            }

            // Get all field names
            const fields = new Set();
            data.records.forEach(record => {
                Object.keys(record).forEach(key => {
                    if (key !== 'attributes') fields.add(key);
                });
            });

            // Build table
            let html = '<table>';
            html += '<thead><tr>';
            fields.forEach(field => {
                html += `<th>${field}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.records.forEach(record => {
                html += '<tr>';
                fields.forEach(field => {
                    let value = record[field];
                    if (typeof value === 'object' && value !== null) {
                        value = value.Name || value.Id || JSON.stringify(value);
                    }
                    html += `<td>${value || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            html += `<div style="margin-top: 15px; color: #666; font-size: 14px;">Showing ${data.records.length} of ${data.totalSize} records</div>`;
            
            document.getElementById('results').innerHTML = html;
        }

        function setQuery(query) {
            document.getElementById('soqlQuery').value = query;
        }

        function formatQuery() {
            const textarea = document.getElementById('soqlQuery');
            const query = textarea.value.trim();
            
            if (!query) return;
            
            const formatted = query
                .replace(/SELECT\s+/i, 'SELECT\n    ')
                .replace(/\s+FROM\s+/i, '\nFROM ')
                .replace(/\s+WHERE\s+/i, '\nWHERE ')
                .replace(/\s+ORDER\s+BY\s+/i, '\nORDER BY ')
                .replace(/\s+LIMIT\s+/i, '\nLIMIT ')
                .replace(/,\s*/g, ',\n    ');
            
            textarea.value = formatted;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">Results cleared</div>';
            showStatus('', '');
        }

        function showStatus(message, type) {
            const status = document.getElementById('connectionStatus');
            const queryStatus = document.getElementById('queryStatus');
            
            if (!message) {
                status.innerHTML = '';
                queryStatus.innerHTML = '';
                return;
            }
            
            const html = `<div class="status ${type}">${message}</div>`;
            status.innerHTML = html;
            queryStatus.innerHTML = html;
        }



        // Auto-save session ID
        document.getElementById('sessionId').addEventListener('input', function() {
            localStorage.setItem('salesforce_session_id', this.value);
        });

        // Load saved session ID
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('salesforce_session_id');
            if (saved) {
                document.getElementById('sessionId').value = saved;
            }
        });
    </script>
   <script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			agentforce_messaging.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

			agentforce_messaging.init(
				'00DSG00000XOfTf', // sdb6 test org id
				    'cwc_salesforce_2', // sdb6 test org EmbeddedServiceDeployments
					'https://orgfarm-e273870cdc.my.site-com.dgjoal5mtz1l0d02qqbr423m301.wb.crm.dev:6101/ESWCWCService11755805066287', // workspace site url
					{
						scrt2URL: 'https://orgfarm-0b9845e12f.test1.my.pc-rnd.salesforce-scrt.com' // sdb6 test org scrt2URL
					}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://orgfarm-e273870cdc.my.site-com.dgjoal5mtz1l0d02qqbr423m301.wb.crm.dev:6101/ESWCWCService11755805066287/assets/js/init.js'  onload='initEmbeddedMessaging()'></script>
</body>
</html>
